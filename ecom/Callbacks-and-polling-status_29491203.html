<!DOCTYPE html>
<html>
    <head>
        <title>Resurs Bank e-Commerce Platform : Callbacks and polling status</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Resurs Bank e-Commerce Platform</a></span>
                            </li>
                                                    <li>
                                <span><a href="The-Resurs-Bank-E-Commerce-Platform_327701.html">The Resurs Bank E-Commerce Platform</a></span>
                            </li>
                                                    <li>
                                <span><a href="Consumer-Loan-API_16056949.html">Consumer Loan API</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Resurs Bank e-Commerce Platform : Callbacks and polling status
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Patric Johnsson</span>, last modified by <span class='editor'> Bobil Poli</span> on 2023-03-15
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>There are two ways to get information regarding the loan status - to poll the loan application reference or to register a callbackURL which will automatically send you an update when a change is made to the status.</p><p>The following events will trigger a callback; CREDIT_DECISION_UPDATED, SIGNED, WAITING_FOR_ADDITION and PAID_OUT.</p><p>Below is both methods explained with example requests &amp; responses.<br/><br/></p><div class="confluence-information-macro confluence-information-macro-information"><p class="title conf-macro-render">Important!</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">In order to test callback properly, you'll need to use your specific webservice-credentials that has been sent to you. <br/>testse, testno, testdk, testfi will not work, since integrators will overwrite eachothers callback-url.</div></div><p><br/></p><h2 id="Callbacksandpollingstatus-Retrievestatuschangewithcallback"><strong>Retrieve status change with callback</strong></h2><h3 id="Callbacksandpollingstatus-Registerthecallback-URL">Register the callback-URL</h3><p>To set a callbackURL, you send in the desired URL in xml-format. The callbackUrl is to be sent in only once! See example below.<br/>There is also an option to set credentials for the callback, this is optional. The auth methods are either BASIC and BEARER, with a base 64 encoded credentials</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>setCallback-example request</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&lt;setCallback&gt;
    &lt;callbackConfiguration&gt;
            &lt;callbackUrl&gt;http://agent.com/url-to-callback&lt;/callbackUrl&gt;
            &lt;callbackCredentials&gt;#The base64 encoded credentials#&lt;/callbackCredentials&gt;
            &lt;callbackAuthMethod&gt;(BASIC|BEARER)&lt;/callbackAuthMethod&gt;
     &lt;/callbackConfiguration&gt;
&lt;/setCallback&gt;</pre>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>setCallback-example response</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&lt;setCallbackResponse&gt;
    &lt;setCallbackResult&gt;
        &lt;callbackSet&gt;true&lt;/callbackSet&gt;
        &lt;message&gt;Set callback successful&lt;/message&gt;
    &lt;/setCallbackResult&gt;
&lt;/setCallbackResponse&gt;</pre>
</div></div><h3 id="Callbacksandpollingstatus-HowtotriggeracallbackintestenvironmentwithPostman-example">How to trigger a callback in test environment with Postman-example</h3><p>On the following Swagger-link, you can find how to setup the triggering of a callback with a GET - <a href="https://apigw.integration.resurs.com/api_docs/external_test_utils" class="external-link" rel="nofollow">https://apigw.integration.resurs.com/api_docs/external_test_utils</a><br/>To trigger a specific callback, the applicationReference from the submitApplicationExt-response must be provided.<br/>If you run your test thru Postman, simply configure GET and insert the end point; no authorization nor body is required - see the example below;</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" height="400" src="attachments/29491203/59342879.png" data-image-src="attachments/29491203/59342879.png" data-unresolved-comment-count="0" data-linked-resource-id="59342879" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2021-9-15_10-8-56.png" data-base-url="https://test.resurs.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="29491203" data-linked-resource-container-version="30" alt=""></span></p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><strong>NOTE!</strong> Once one or more callbacks has been triggered, the application may not be treated as normal since there can be side effects due the “manual” triggering</div></div><h3 id="Callbacksandpollingstatus-Examplecallbacks-allsentinJSON-format">Example callbacks - all sent in JSON-format</h3><h4 id="Callbacksandpollingstatus-SIGNED–whenthesignedagreementisreceived">SIGNED – when the signed agreement is received</h4><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>SIGNED </b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;externalApplicationEvent&quot; : {
    &quot;applicationReference&quot; : &quot;ABC-123&quot;,
    &quot;applicationEventType&quot; : &quot;SIGNED&quot;
  },
  &quot;jwsData&quot; : &quot;eyJOXAiOLADikz.eyJpc3MiJgbDQrm4.djjft4CP-mbW1&quot;
}</pre>
</div></div><p><br/></p><h4 id="Callbacksandpollingstatus-CREDIT_DECISION_UPDATED–APPROVED–wheninitialcreditdecisionmanual_inspectionischangedtoapproved">CREDIT_DECISION_UPDATED – APPROVED – when initial credit decision manual_inspection is changed to approved</h4><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>CREDIT_DECISION_UPDATED – APPROVED</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;externalApplicationEvent&quot; : {
    &quot;applicationReference&quot; : &quot;abc-123-def-567&quot;,
    &quot;applicationEventType&quot; : &quot;CREDIT_DECISION_UPDATED&quot;,
    &quot;creditDecision&quot; : {
        &quot;creditDecision&quot; : &quot;APPROVED&quot;,
        &quot;approvedAmount&quot; : 10000,
        &quot;interest&quot; : 12.3,
        &quot;tenor&quot; : 12,
        &quot;effectiveInterest&quot; : 23.3,
        &quot;monthlyCost&quot; : 1234,
        &quot;consolidationDemand&quot; : 2300,
        &quot;adminFee&quot; : 199,
        &quot;arrangementFee&quot; : 599.99,
        &quot;totalRepaymentAmount&quot; : 13000,
		&quot;monthlyAccountFee&quot; : 0,
        &quot;totalFeesAndInterest&quot;: 3000.00,
        &quot;documentTypes&quot; : [ &quot;ID&quot;, &quot;PAYMENT_SLIP&quot; ]
    }
  },
  &quot;jwsData&quot; : &quot; eyJOXAiOLADikz.eyJpc3MiJgbDQrm4.djjft4CP-mbW1&quot;
}</pre>
</div></div><p><br/></p><h4 id="Callbacksandpollingstatus-CREDIT_DECISION_UPDATED–REJECTED–wheninitialcreditdecisionmanual_inspectionischangedtorejected">CREDIT_DECISION_UPDATED – REJECTED – when initial credit decision manual_inspection is changed to rejected</h4><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>CREDIT_DECISION_UPDATED – REJECTED</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;externalApplicationEvent&quot; : {
    &quot;applicationReference&quot; : &quot;abc-123-def-567&quot;,
    &quot;applicationEventType&quot; : &quot;CREDIT_DECISION_UPDATED&quot;,
    &quot;creditDecision&quot; : {
        &quot;creditDecision&quot; : &quot;REJECTED&quot;,
		&quot;approvedAmount&quot; : 0
    }
  },
  &quot;jwsData&quot; : &quot; eyJOXAiOLADikz.eyJpc3MiJgbDQrm4.djjft4CP-mbW1&quot;
}</pre>
</div></div><p><br/></p><h4 id="Callbacksandpollingstatus-WAITING_FOR_ADDITION–whenweareawaitingadditionalinformationfromthecustomer">WAITING_FOR_ADDITION – when we are awaiting additional information from the customer</h4><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>WAITING_FOR_ADDITION</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;externalApplicationEvent&quot; : {
    &quot;requiredDocuments&quot; : [ &quot;ID&quot; ],
    &quot;applicationReference&quot; : &quot;abc-123-def-567&quot;,
    &quot;applicationEventType&quot; : &quot;WAITING_FOR_ADDITION&quot;
  },
  &quot;jwsData&quot; : &quot; eyJOXAiOLADikz.eyJpc3MiJgbDQrm4.djjft4CP-mbW1&quot;
}</pre>
</div></div><p><br/></p><h4 id="Callbacksandpollingstatus-PAID_OUT-WhenResurshaspaidouttheloan.(Disclaimer!Thiscallbackcannotbegeneratedintestenvironment)">PAID_OUT - When Resurs has paid out the loan. (Disclaimer! This callback cannot be generated in test environment)</h4><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>PAID_OUT</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;externalApplicationEvent&quot; : {
    &quot;applicationReference&quot; : &quot;ABC-123&quot;,
    &quot;applicationEventType&quot; : &quot;PAID_OUT&quot;
  },
  &quot;jwsData&quot; : &quot; eyJOXAiOLADikz.eyJpc3MiJgbDQrm4.djjft4CP-mbW1&quot;
}</pre>
</div></div><p><br/></p><h3 id="Callbacksandpollingstatus-jwsData"><strong>jwsData<br/></strong></h3><div class="confluence-information-macro confluence-information-macro-note"><p class="title conf-macro-render">Observe</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Using jwsData is optional!</p><p>All questions regarding jwsData or API-key is to be sent to support@resurs.se, not our usual email onboarding@resurs.se</p></div></div><p><br/></p><p>The value in jwsData is a signed and serialized JWT, known as a JWS (JSON Web Signature). jwsData is a data structure cryptographically securing a JWS Header and a JWS Payload with a JWS Signature (graphically explained below).</p><p><br/></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" height="85" src="attachments/29491203/29491242.png" data-image-src="attachments/29491203/29491242.png" data-unresolved-comment-count="0" data-linked-resource-id="29491242" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2020-2-3_10-33-8.png" data-base-url="https://test.resurs.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="29491203" data-linked-resource-container-version="30" alt=""></span></p><p><br/>If you want to verify the JWS, you are to download our public keys from <em><a href="https://apigw.resurs.com/api/auth_service/jwks" class="external-link" rel="nofollow">https://apigw.resurs.com/api/auth_service/jwks</a></em>. Note that you must use an API-key, which is handed out by us, in order to call the mentioned URL.<br/>For test environment, you can download the public key from <a href="https://apigw.integration.resurs.com/api/auth_service/jwks" class="external-link" rel="nofollow">https://apigw.integration.resurs.com/api/auth_service/jwks</a>. </p><p>Below is an example of verification </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Example-request for verification</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">curl -X GET &quot;https://apigw.integration.resurs.com/api/auth_service/jwks&quot; -H &quot;accept: application/json&quot; -H &quot;apikey: e3331b3687xxxxxxxxxxd9d4197f30b9</pre>
</div></div><p>Found below is an example layout of a public key.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Example layout of a public key</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
    &quot;keys&quot;: [
        {
            &quot;kty&quot;: &quot;RSA&quot;,
            &quot;e&quot;: &quot;AQAB&quot;,
            &quot;use&quot;: &quot;sig&quot;,
            &quot;kid&quot;: &quot;1cb06a4a-3465-4f11-ac3d-d8bb2bdb1eb7&quot;,
            &quot;alg&quot;: &quot;RS256&quot;,
            &quot;n&quot;: &quot;lLtFi6baHG0yJfWKCFlfY5hMlqUoqvTWwFyjsKckuI62WVwv-GJ1vTPnCk9cptRjqGltQ4IJxv8FYOPPjaRi98li53BnaHRmg6pITF68OAIbnTpMn3_hqctSS_6XM2s-PFMfctbFuSj_W4IzC2f1FmCXJSONz16zxy6kvlyC-ZVBLbN1WpWsheufGqR7tWibj780lgA8nwTQNHUXhdlydOU3CVfGEgs9IRx8vB53n0nTHwBdMI5i5ta9wEe2f7r6I4YqganJL_q_ilYfrbAB2yOCQz4AiWOpQzrhZCV54tiSGfz4lVfVS_oJOy17LapdSqxnBmJwX_R4uTR0g7BLWw&quot;
        },
        {
            &quot;kty&quot;: &quot;RSA&quot;,
            &quot;e&quot;: &quot;AQAB&quot;,
            &quot;use&quot;: &quot;sig&quot;,
            &quot;kid&quot;: &quot;e434a27b-e1fb-4f7f-89d6-fb4e95619aac&quot;,
            &quot;alg&quot;: &quot;RS256&quot;,
            &quot;n&quot;: &quot;vUUYiYxqYwCHreCGlCBn0YjCBoLa-jrqfEhSLAWafCxaGFs5mAXrzb6Zzc_cfzNptNQMtA4x2qhF68copSbGyXxq8ZQl-10J0cjLJ2HW98-5jJiGit3MIR5cEGEjMrRzdaltCFiGSIeussdJMOvNtJk7-OGMQgxMVMJ6PK5zARsNauj85WuB2UyOg6EDBRP7pfmQ9V4bBRGM-s3PQZbBCD-       Mcr1K0tQTc60wftRiC78AxlVubF60jpj6l1bcvpsdld8uF1wVIrU8gjh65CL9KTXMmb261PLrv-op8TSjFMT-DPw4Jb54RxqjbEO9ze6b6BJo-0eU7_suqzitMT4JaQ&quot;
        }
    ]
}</pre>
</div></div><p><br/></p><h2 id="Callbacksandpollingstatus-Topolltheapplicationreference"><strong>To poll the application reference</strong></h2><p>Simply enter the application reference, which was retrieved in the submitApplicationExt-response, to see whether an update has been made. See example request &amp; response below.</p><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>getApplicationStatus-request</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&lt;getApplicationStatus&gt;
    &lt;applicationReference&gt;14321-21234-445674-434344-345445&lt;/applicationReference&gt;
&lt;/getApplicationStatus&gt;</pre>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>getApplicationStatusResponse-example</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&lt;getApplicationStatusResponse&gt;
    &lt;waitingForAddition&gt;true|false&lt;/waitingForAddition&gt;
    &lt;signedWithMethod&gt;E_SIGN|ANALOG&lt;/signedWithMethod&gt;
    &lt;requestedSigningMethod&gt;E_SIGN|MANUAL&lt;/requestedSigningMethod&gt;
    &lt;paidOut&gt;true|false&lt;/paidOut&gt;
&lt;/getApplicationStatusResponse&gt;</pre>
</div></div><p><br/></p><p><br/></p><p><br/></p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/29491203/29491242.png">image2020-2-3_10-33-8.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/29491203/59342879.png">image2021-9-15_10-8-56.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on 2024-02-01 10:49</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
